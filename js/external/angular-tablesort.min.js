var tableSortModule=angular.module("tableSort",[]);tableSortModule.directive("tsWrapper",["$log","$parse",function(t,r){"use strict";return{scope:!0,controller:["$scope",function(t){t.sortExpression=[],t.headings=[];var e=function(t){return[r(t),null,!1]};this.setSortField=function(r,s){var o,a=e(r);if(1===t.sortExpression.length&&t.sortExpression[0][0]===a[0])t.sortExpression[0][2]?(s.removeClass("tablesort-desc"),s.addClass("tablesort-asc"),t.sortExpression[0][2]=!1):(s.removeClass("tablesort-asc"),s.addClass("tablesort-desc"),t.sortExpression[0][2]=!0);else{for(o=0;o<t.headings.length;o+=1)t.headings[o].removeClass("tablesort-desc").removeClass("tablesort-asc");s.addClass("tablesort-asc"),t.sortExpression=[a]}},this.addSortField=function(r,s){var o,a=!1,n=e(r);for(o=0;o<t.sortExpression.length;o+=1)t.sortExpression[o][0]===n[0]&&(t.sortExpression[o][2]?(s.removeClass("tablesort-desc"),s.addClass("tablesort-asc"),t.sortExpression[o][2]=!1):(s.removeClass("tablesort-asc"),s.addClass("tablesort-desc"),t.sortExpression[o][2]=!0),a=!0);a||(s.addClass("tablesort-asc"),t.sortExpression.push(n))},this.setTrackBy=function(r){t.trackBy=r},this.registerHeading=function(r){t.headings.push(r)},t.sortFun=function(r,e){var s,o,a,n,i;for(s=0;s<t.sortExpression.length;s+=1){if(o=t.sortExpression[s][0](r),a=t.sortExpression[s][0](e),i=e[t.sortExpression[s][1]],i&&(o=i(o),a=i(a)),void 0===o&&(o=""),void 0===a&&(a=""),n=t.sortExpression[s][2],o>a)return n?-1:1;if(a>o)return n?1:-1}if(t.trackBy){if(o=r[t.trackBy],a=e[t.trackBy],void 0===o&&(o=""),void 0===a&&(a=""),o>a)return n?-1:1;if(a>o)return n?1:-1}return 0}}]}}]),tableSortModule.directive("tsCriteria",function(){return{require:"^tsWrapper",link:function(t,r,e,s){var o=function(o){t.$apply(function(){o.shiftKey?s.addSortField(e.tsCriteria,r):s.setSortField(e.tsCriteria,r)})};r.bind("click",o),r.addClass("tablesort-sortable"),"tsDefault"in e&&"0"!==e.tsDefault&&(s.addSortField(e.tsCriteria,r),"descending"==e.tsDefault&&s.addSortField(e.tsCriteria,r)),s.registerHeading(r)}}}),tableSortModule.directive("tsRepeat",["$compile",function(t){return{terminal:!0,require:"^tsWrapper",priority:1e6,link:function(r,e,s,o){var a=e.clone(),n=e[0].childElementCount,i="ng-repeat";"undefined"==typeof a.attr(i)&&(i="data-ng-repeat");var l=a.attr(i),d=null,u=l.match(/\s+track\s+by\s+\S+?\.(\S+)/);for(u&&(d=u[1],o.setTrackBy(d)),l=-1!=l.search(/tablesort/)?l.replace(/tablesort/,"tablesortOrderBy:sortFun"):l.replace(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(\s+track\s+by\s+[\s\S]+?)?\s*$/,"$1 in $2 | tablesortOrderBy:sortFun$3");e[0].firstChild;)e[0].removeChild(e[0].firstChild);var c=document.createElement("td");c.colSpan=n,e[0].appendChild(c),e[0].className+=" showIfLast",a.removeAttr("ts-repeat"),a.attr(i,l);var p=t(a)(r);e.after(p)}}}]),tableSortModule.filter("tablesortOrderBy",function(){return function(t,r){if(t){for(var e=[],s=0;s<t.length;s++)e.push(t[s]);return e.sort(r)}}}),tableSortModule.filter("parseInt",function(){return function(t){return parseInt(t)||null}}),tableSortModule.filter("parseFloat",function(){return function(t){return parseFloat(t)||null}});